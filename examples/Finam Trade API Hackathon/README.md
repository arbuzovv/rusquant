
# Rusquant Finam bot

## Введение

Робот, созданный на языке программирования R для использования с Finam Trade API, представляет собой торговую систему, которая автоматически принимает решения о покупке и продаже фьючерсов в конце дня на основе альфа-стратегий.

Альфа (или альфа-стратегия) - это комбинация математической формулы, компьютерного кода и параметров, которая при добавлении к ним исторических данных способна прогнозировать будущие движения различный финансовых инструментов (определение из [книги](https://www.amazon.com/Finding-Alphas-Quantitative-Approach-Strategies/dp/1119057868)).

Торговый робот торгует портфель альфа-стратегий, который он выбирает по заданным пользователем критериям. Для удобства код разделен на 2 части: исследовательскую (квантовую) (файл quant.R) и торговую (tradebot.R).

В исследовательской части пользователь формируем набор альфа-стратегий, которые он собирается торговать, оценивает их риск-доходность и формирует портфель стратегий, который он будет торговать.

В торговой части реализована логика исполнения торговых сигналов.

## Требования

Для локального запуска кода потребуется установка R и библиотеки rusquant.

``` r
# install.packages("devtools") # if not installed
# options(download.file.method = "libcurl") # if problems with "Error in utils::download.file(url, path...."

library(devtools)
install_github("arbuzovv/rusquant")
```

Торговый робот использует библиотки quantmod, PortfolioAnalytics и PerformanceAnalytics, которые будут автоматически загружены при установки библиотеки rusquant.

## Технологии

Торговый робот создан таким образом, чтобы укладыватся в современные тренды связанные с микросервисной архитекрутой и бессерверными вычислениями. В рамках данного хакатона был реализован микросервис по расчету альфа стратегий и написан для него [API](https://swagger.rusquant.ru). API реализован в [Yandex Cloud](https://cloud.yandex.ru). Разработанный робот способен запускаться в бессерверном режиме Yandex Cloud. Для анализа и управления роботом в бессерверном режиме можно использовать DataLens. Ссылка на [фронтэнд](https://datalens.yandex/4l4yydg8alqou) разработанного торгового робота Не смотря на более современный протокол GRPC - внутри библиотки rusquant используется REST API для того, чтобы торговых роботов можно было запускать на облачных платформах.

Благодаря такому подходу можно запускать торговых роботов в облаке, что дает ряд преимуществ:

1.  Безопасность: робот хранится на сервере в облаке, а не на локальном компьютере, что делает его менее уязвимым для взлома или вирусных атак.

2.  Надежность: сервера в облаке обычно имеют высокий уровень надежности и доступности, что означает, что ваш торговый робот всегда будет работать, даже если у вас возникнут проблемы с локальным компьютером.

3.  Масштабируемость: использование серверов в облаке позволяет легко масштабировать робота, чтобы обрабатывать большие объемы данных и более сложные задачи.

4.  Удобство использования: торговый робот в облаке обычно может быть запущен и управляться из любого устройства с доступом в Интернет, что делает его очень удобным в использовании.

## Исследовательная часть (количественный анализ)

Описание того, что происходит в файле quant.R

Сначала робот выбирает альфа-стратегии с высокой доходностью по различным периодам времени, используя критерии Sharpe Ratio и процент прибыли за последний месяц. Затем робот получает данные по этим альфа-стратегиям и сигналам, которые они генерируют, за период с 2010 года по текущую дату. Для каждой альфа-стратегии робот рассчитывает ее будущую доходность и объединяет их в общую таблицу.

Затем робот создает портфель, состоящий из выбранных альфа-стратегий, используя различные ограничения на минимальную и максимальную долю каждой стратегии в портфеле, а также на общую долю портфеля, которую можно инвестировать в активы. Робот оптимизирует этот портфель для максимизации доходности при ограниченном риске, используя пакет PortfolioAnalytics.

Робот также строит границу эффективных портфелей по доходности и риску, чтобы показать, какой портфель находится на границе эффективности. Робот использует пакет PerformanceAnalytics для анализа доходности портфеля и его показателей, таких как Sharpe Ratio и Calmar Ratio.

После выбранного портфеля альфа-стратегий сохраняются веса и выбранные стратегии для последующей торговли.

Данная исследовательская часть, может запускаться с пользователем с той периодичностью с которой он хочет перетряхивать портфель (каждый день, раз в месяц, раз в год, единожды)

## Торговая часть

Описание tradebot.R

Данный торговый робот использует Rest API для взаимодействия с брокером Finam. Он осуществляет автоматическую торговлю на фондовой бирже. Для взаимодействия с Finam

Робот получает список символов, доступных для торговли, и вычисляет позиции, которые необходимо открыть для торговли. Для расчета размера позиции используется текущий баланс счета и заданный плечевой эффект.

Затем робот сравнивает рассчитанные позиции с текущим портфелем и определяет разницу. Для открытия новых позиций робот использует Rest API для отправки торговых ордеров на биржу.

Робот ожидает 1 минуту, а затем проверяет статус своих ордеров. Если ордер не был исполнен, робот отменяет его и отправляет новый ордер с обновленным ценой.

В конце торгового дня робот сохраняет данные о своих позициях и сделках в формате CSV для последующего анализа.

Преимуществом данного торгового робота является возможность автоматической торговли на бирже с использованием Rest API, что позволяет сократить время, затрачиваемое на торговлю, и уменьшить возможные ошибки, вызванные человеческим фактором.

## Выполнение критериев оценки

**Идея проекта:**

*Новизна:*

-   в рамках проекта была разработана API позволяющая упростить часть связанную с исследовательским воркфло. Данное API можно воспринимать как сервис "Worldquant по подписке"

-   разработана библиотека rusquant, которая содержит в себе методы работы с различными брокерами через API (Финам, Алор, Тинькофф)

*Использование открытые данных:*

-   в рамках проекта были реализованы удобные функции подключения к открытым данным Финам (экспорт котировок), Алор (API), Московская биржа (API), Mfd.ru (экспорт котировок), Poloniex, MarketWatch.

-   Для расчета альфа-стратегий используются данные загружаемые с Финам (экспорт котировок)

**Качество исполнения:**

*Дизайн:*

-   все основные функции собраны в библиотеку и размещены на [github](https://github.com/arbuzovv/rusquant), библиотека подготовлена и отправлена на CRAN

*Функциональность:*

-   позволяет проводить количественный анализ, создавать и оценивать предполагаемую доходность портфеля, исполнять заявку

*Технологичность:*

-   большинство сервисов используют Yandex Cloud
